<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Member Aqshamart</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 480px;
        margin: 0 auto;
        background: white;
        min-height: 100vh;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      @media (min-width: 768px) {
        .container {
          max-width: 800px;
          margin: 20px auto;
          border-radius: 20px;
          min-height: calc(100vh - 40px);
        }
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        padding: 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>')
          repeat;
        animation: float 20s infinite linear;
      }

      @keyframes float {
        0% {
          transform: translateX(0) translateY(0);
        }
        100% {
          transform: translateX(-50px) translateY(-50px);
        }
      }

      .header-title {
        color: white;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
        z-index: 2;
        position: relative;
      }

      .header-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 16px;
        z-index: 2;
        position: relative;
      }

      /* Benefits Section */
      .benefits {
        background: white;
        padding: 20px;
        border-bottom: 1px solid #eee;
      }

      .benefits-title {
        text-align: center;
        color: #ff6b35;
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
      }

      .benefits-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      @media (min-width: 768px) {
        .benefits-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      .benefit-item {
        display: flex;
        align-items: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 10px;
        transition: transform 0.3s ease;
      }

      .benefit-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .benefit-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #ff6b35, #f7931e);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        color: white;
      }

      .benefit-text {
        font-size: 14px;
        color: #555;
        line-height: 1.3;
      }

      /* Form */
      .form-container {
        padding: 30px 20px;
      }

      .form-title {
        text-align: center;
        color: #333;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        color: #555;
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: white;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #ff6b35;
        box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }

      .form-textarea {
        min-height: 80px;
        resize: vertical;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
      }

      @media (min-width: 768px) {
        .form-row {
          grid-template-columns: 1fr 1fr;
        }
      }

      .submit-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #ff6b35, #f7931e);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
      }

      .submit-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      /* Loading Animation */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .loading-content {
        background: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 300px;
        width: 90%;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #ff6b35;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        color: #333;
        font-size: 16px;
        font-weight: 600;
      }

      /* Success Popup */
      .success-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1001;
      }

      .success-content {
        background: white;
        padding: 40px 30px;
        border-radius: 20px;
        text-align: center;
        max-width: 400px;
        width: 90%;
      }

      .success-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #4caf50, #45a049);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        color: white;
        font-size: 40px;
      }

      .success-title {
        color: #333;
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 15px;
      }

      .success-message {
        color: #666;
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 20px;
      }

      .success-instruction {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        padding: 15px;
        border-radius: 10px;
        color: #856404;
        font-size: 14px;
        margin-bottom: 20px;
      }

      .close-btn {
        background: #ff6b35;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
      }

      .error-message {
        color: #dc3545;
        font-size: 12px;
        margin-top: 5px;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1 class="header-title">Bergabung dengan Aqshamart Community</h1>
        <p class="header-subtitle">
          Nikmati berbagai keuntungan eksklusif untuk member
        </p>
      </div>

      <!-- Benefits Section -->
      <div class="benefits">
        <h2 class="benefits-title">Keuntungan Menjadi Member</h2>
        <div class="benefits-grid">
          <div class="benefit-item">
            <div class="benefit-icon">
              <i class="fas fa-bell"></i>
            </div>
            <div class="benefit-text">
              Prioritas mendapat info promo terbaru
            </div>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">
              <i class="fas fa-tags"></i>
            </div>
            <div class="benefit-text">
              Penawaran spesial dengan harga khusus
            </div>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">
              <i class="fas fa-shipping-fast"></i>
            </div>
            <div class="benefit-text">
              Layanan pesan antar cepat & FREE ongkir
            </div>
          </div>
        </div>
      </div>

      <!-- Form -->
      <div class="form-container">
        <h2 class="form-title">Daftar Member Sekarang</h2>
        <form id="memberForm">
          <div class="form-group">
            <label class="form-label">Nama Lengkap *</label>
            <input
              type="text"
              class="form-input"
              id="namaLengkap"
              name="namaLengkap"
              required
            />
            <div class="error-message" id="error-namaLengkap">
              Nama lengkap harus diisi
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Sapaan *</label>
              <select class="form-select" id="sapaan" name="sapaan" required>
                <option value="">Pilih Sapaan</option>
                <option value="Bapak">Bapak</option>
                <option value="Ibu">Ibu</option>
                <option value="Mas">Mas</option>
                <option value="Mbak">Mbak</option>
                <option value="Kak">Kak</option>
              </select>
              <div class="error-message" id="error-sapaan">
                Sapaan harus dipilih
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Panggilan *</label>
              <input
                type="text"
                class="form-input"
                id="panggilan"
                name="panggilan"
                required
              />
              <div class="error-message" id="error-panggilan">
                Panggilan harus diisi
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Nomor HP (WhatsApp) *</label>
            <input
              type="tel"
              class="form-input"
              id="nomorHP"
              name="nomorHP"
              placeholder="Contoh: 08123456789"
              required
            />
            <div class="error-message" id="error-nomorHP">
              Nomor HP harus diisi dengan format yang benar
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Tanggal Lahir *</label>
            <input
              type="date"
              class="form-input"
              id="tanggalLahir"
              name="tanggalLahir"
              required
            />
            <div class="error-message" id="error-tanggalLahir">
              Tanggal lahir harus diisi
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Agama *</label>
              <select class="form-select" id="agama" name="agama" required>
                <option value="">Pilih Agama</option>
                <option value="Islam">Islam</option>
                <option value="Kristen">Kristen</option>
                <option value="Katolik">Katolik</option>
                <option value="Hindu">Hindu</option>
                <option value="Buddha">Buddha</option>
                <option value="Konghucu">Konghucu</option>
              </select>
              <div class="error-message" id="error-agama">
                Agama harus dipilih
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Jenis Kelamin *</label>
              <select
                class="form-select"
                id="jenisKelamin"
                name="jenisKelamin"
                required
              >
                <option value="">Pilih Jenis Kelamin</option>
                <option value="Laki-laki">Laki-laki</option>
                <option value="Perempuan">Perempuan</option>
              </select>
              <div class="error-message" id="error-jenisKelamin">
                Jenis kelamin harus dipilih
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Alamat Lengkap *</label>
            <textarea
              class="form-textarea"
              id="alamat"
              name="alamat"
              placeholder="Masukkan alamat lengkap Anda"
              required
            ></textarea>
            <div class="error-message" id="error-alamat">
              Alamat harus diisi
            </div>
          </div>

          <button type="submit" class="submit-btn">
            <i class="fas fa-user-plus"></i> DAFTAR MEMBER SEKARANG
          </button>
        </form>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">Pendaftaran sedang diproses...</div>
      </div>
    </div>

    <!-- Success Popup -->
    <div class="success-popup" id="successPopup">
      <div class="success-content">
        <div class="success-icon">
          <i class="fas fa-check"></i>
        </div>
        <h3 class="success-title">Selamat!</h3>
        <p class="success-message">
          Anda sudah berhasil tergabung dengan member Aqshamart Community
        </p>
        <div class="success-instruction">
          <strong
            >Tunjukkan pop-up ini ke kasir atau call center kami untuk
            mendapatkan benefit member!</strong
          >
        </div>
        <button class="close-btn" onclick="closeSuccessPopup()">Tutup</button>
      </div>
    </div>

    <script>
      // GANTI URL ini dengan Web App URL dari Google Apps Script Anda
      const GOOGLE_SHEETS_URL =
        "https://script.google.com/macros/s/AKfycbzc3uaQkF0MGQIevejeaKeFe32MgVhtjpFrsE4TzokaVrAuYozyrF8nWSZZLlzraGP4Nw/exec";

      // Function untuk close success popup
      function closeSuccessPopup() {
        document.getElementById("successPopup").style.display = "none";
      }

      // Function untuk validasi form
      function validateForm(data) {
        let isValid = true;
        const errors = {};

        // Reset error messages
        document.querySelectorAll(".error-message").forEach((el) => {
          el.style.display = "none";
        });

        // Validasi setiap field
        const requiredFields = {
          namaLengkap: "Nama lengkap",
          sapaan: "Sapaan",
          panggilan: "Panggilan",
          nomorHP: "Nomor HP",
          tanggalLahir: "Tanggal lahir",
          agama: "Agama",
          jenisKelamin: "Jenis kelamin",
          alamat: "Alamat",
        };

        Object.keys(requiredFields).forEach((field) => {
          const value = data[field];
          if (!value || value === "" || value.toString().trim() === "") {
            errors[field] = `${requiredFields[field]} harus diisi`;
            isValid = false;
          }
        });

        // Validasi format nomor HP
        if (data.nomorHP && data.nomorHP !== "") {
          const phoneRegex = /^(\+62|62|0)[0-9]{9,13}$/;
          const cleanPhone = data.nomorHP.replace(/\D/g, "");
          if (
            !phoneRegex.test(cleanPhone) &&
            !phoneRegex.test("0" + cleanPhone)
          ) {
            errors.nomorHP = "Format nomor HP tidak valid";
            isValid = false;
          }
        }

        // Validasi tanggal lahir
        if (data.tanggalLahir && data.tanggalLahir !== "") {
          const birthDate = new Date(data.tanggalLahir);
          const today = new Date();
          if (birthDate > today) {
            errors.tanggalLahir = "Tanggal lahir tidak boleh di masa depan";
            isValid = false;
          }
        }

        // Tampilkan error messages
        Object.keys(errors).forEach((field) => {
          const errorEl = document.getElementById(`error-${field}`);
          if (errorEl) {
            errorEl.textContent = errors[field];
            errorEl.style.display = "block";
          }
        });

        return isValid;
      }

      // Function untuk collect form data
      function collectFormData() {
        const data = {};
        const fields = [
          "namaLengkap",
          "sapaan",
          "panggilan",
          "nomorHP",
          "tanggalLahir",
          "agama",
          "jenisKelamin",
          "alamat",
        ];

        fields.forEach((field) => {
          const element = document.getElementById(field);
          if (element) {
            data[field] = String(element.value || "").trim();
          } else {
            data[field] = "";
          }
        });

        return data;
      }

      // Function untuk format nomor HP
      function formatPhoneNumber(phone) {
        let cleanPhone = phone.replace(/\D/g, "");

        if (cleanPhone.startsWith("0")) {
          cleanPhone = "62" + cleanPhone.substring(1);
        } else if (cleanPhone.startsWith("8")) {
          cleanPhone = "62" + cleanPhone;
        } else if (!cleanPhone.startsWith("62")) {
          cleanPhone = "62" + cleanPhone;
        }

        return cleanPhone;
      }

      // Function untuk menyimpan data ke Google Sheets
      async function saveToGoogleSheets(data) {
        try {
          // Prepare clean data
          const cleanData = {
            namaLengkap: String(data.namaLengkap || "").trim(),
            sapaan: String(data.sapaan || "").trim(),
            panggilan: String(data.panggilan || "").trim(),
            nomorHP: String(data.nomorHP || "").trim(),
            tanggalLahir: String(data.tanggalLahir || "").trim(),
            agama: String(data.agama || "").trim(),
            jenisKelamin: String(data.jenisKelamin || "").trim(),
            alamat: String(data.alamat || "").trim(),
          };

          // FIX CORS ISSUE: Use text/plain content type
          const response = await fetch(GOOGLE_SHEETS_URL, {
            method: "POST",
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
            body: JSON.stringify(cleanData),
          });

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const responseText = await response.text();
          let responseData = null;

          try {
            responseData = JSON.parse(responseText);
          } catch (parseError) {
            console.log("Response is not JSON:", responseText);
          }

          // Check if response indicates success
          if (responseData && responseData.success === false) {
            throw new Error(responseData.error || "Server returned error");
          }

          return { success: true, data: responseData };
        } catch (error) {
          console.error("Error in saveToGoogleSheets:", error);
          throw error;
        }
      }

      // Form submission handler
      document
        .getElementById("memberForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Collect form data
          const data = collectFormData();

          // Validate form
          if (!validateForm(data)) {
            return;
          }

          // Show loading
          document.getElementById("loadingOverlay").style.display = "flex";

          try {
            // Format phone number
            data.nomorHP = formatPhoneNumber(data.nomorHP);

            // Save to Google Sheets
            const result = await saveToGoogleSheets(data);

            // Send WhatsApp message (optional)
            try {
              const whatsappMessage = `Terima kasih ${data.sapaan} ${data.panggilan} telah mendaftar menjadi member Aqshamart Community.

Setelah menerima pesan ini, *${data.sapaan}* *${data.panggilan}* langsung dapat menikmati berbagai BENEFIT dari Aqshamart antara lain :
- Prioritas mendapatkan informasi promo atas berbagai produk 
- Selalu mendapat penawaran spesial dengan harga khusus 
- Layanan pesan antar yang cepat & FREE ongkir

Semoga *${data.sapaan}* *${data.panggilan}* & keluarga selalu diberikan kesehatan dan kelancaran rejeki...amin.

Salam Smart,
Yang *SMART* selalu belanja di Aqshamart

_Nomor ini khusus pengiriman pesan notifikasi, sedangkan untuk layanan pesan antar klik link_ : bit.ly/pesan-aqsha

tunjukkan pesan ini di kasir untuk klaim hadiah selama persediaan masih ada`;

              await fetch("https://crm.woo-wa.com/send/message-text", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  deviceId: "d_ID@6753a3309becd_lLMQ0PrnAMfGf",
                  number: data.nomorHP,
                  message: whatsappMessage,
                }),
              });
            } catch (whatsappError) {
              console.log(
                "WhatsApp sending failed (but registration was successful):",
                whatsappError
              );
            }

            // Processing delay
            await new Promise((resolve) => setTimeout(resolve, 1500));

            // Hide loading
            document.getElementById("loadingOverlay").style.display = "none";

            // Show success popup
            document.getElementById("successPopup").style.display = "flex";

            // Reset form
            this.reset();
          } catch (error) {
            console.error("Registration failed:", error);

            // Hide loading
            document.getElementById("loadingOverlay").style.display = "none";

            // Show error message
            alert(
              `Pendaftaran gagal: ${error.message}\n\nSilakan coba lagi atau hubungi customer service.`
            );
          }
        });

      // Real-time validation
      document
        .querySelectorAll(".form-input, .form-select, .form-textarea")
        .forEach((input) => {
          input.addEventListener("blur", function () {
            const data = collectFormData();
            validateForm(data);
          });

          // Clear error on focus
          input.addEventListener("focus", function () {
            const fieldName = this.name;
            const errorEl = document.getElementById(`error-${fieldName}`);
            if (errorEl) {
              errorEl.style.display = "none";
            }
          });
        });

      console.log("Form initialized successfully");
    </script>
  </body>
</html>
